<!doctype html>
<html lang="ru" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">Синтаксис правил DNS-фильтрации | AdGuard DNS Knowledge Base</title><meta data-react-helmet="true" property="og:url" content="https://adguardteam.github.io//KnowledgeBaseDNS/ru/general/dns-filtering-syntax/"><meta data-react-helmet="true" name="docusaurus_locale" content="ru"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Синтаксис правил DNS-фильтрации | AdGuard DNS Knowledge Base"><meta data-react-helmet="true" name="description" content="Введение"><meta data-react-helmet="true" property="og:description" content="Введение"><link data-react-helmet="true" rel="shortcut icon" href="/KnowledgeBaseDNS/ru/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://adguardteam.github.io//KnowledgeBaseDNS/ru/general/dns-filtering-syntax/"><link data-react-helmet="true" rel="alternate" href="https://adguardteam.github.io//KnowledgeBaseDNS/general/dns-filtering-syntax/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://adguardteam.github.io//KnowledgeBaseDNS/ru/general/dns-filtering-syntax/" hreflang="ru"><link data-react-helmet="true" rel="alternate" href="https://adguardteam.github.io//KnowledgeBaseDNS/de/general/dns-filtering-syntax/" hreflang="de"><link data-react-helmet="true" rel="alternate" href="https://adguardteam.github.io//KnowledgeBaseDNS/fr/general/dns-filtering-syntax/" hreflang="fr"><link data-react-helmet="true" rel="alternate" href="https://adguardteam.github.io//KnowledgeBaseDNS/es/general/dns-filtering-syntax/" hreflang="es"><link data-react-helmet="true" rel="alternate" href="https://adguardteam.github.io//KnowledgeBaseDNS/it/general/dns-filtering-syntax/" hreflang="it"><link data-react-helmet="true" rel="alternate" href="https://adguardteam.github.io//KnowledgeBaseDNS/ja/general/dns-filtering-syntax/" hreflang="ja"><link data-react-helmet="true" rel="alternate" href="https://adguardteam.github.io//KnowledgeBaseDNS/ko/general/dns-filtering-syntax/" hreflang="ko"><link data-react-helmet="true" rel="alternate" href="https://adguardteam.github.io//KnowledgeBaseDNS/zh-CN/general/dns-filtering-syntax/" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://adguardteam.github.io//KnowledgeBaseDNS/zh-TW/general/dns-filtering-syntax/" hreflang="zh-TW"><link data-react-helmet="true" rel="alternate" href="https://adguardteam.github.io//KnowledgeBaseDNS/general/dns-filtering-syntax/" hreflang="x-default"><link rel="stylesheet" href="/KnowledgeBaseDNS/ru/assets/css/styles.cc52ce65.css">
<link rel="preload" href="/KnowledgeBaseDNS/ru/assets/js/runtime~main.97a4d7a8.js" as="script">
<link rel="preload" href="/KnowledgeBaseDNS/ru/assets/js/main.9a2496f3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Перейти к основному содержанию</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/KnowledgeBaseDNS/ru/"><img src="/KnowledgeBaseDNS/ru/img/logo.svg" alt="AdGuard DNS" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/KnowledgeBaseDNS/ru/img/logo_dark.svg" alt="AdGuard DNS" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title"></b></a><a class="navbar__item navbar__link navbar__link--active" href="/KnowledgeBaseDNS/ru/">Документы</a><a href="https://adguard.com/blog/tag/adguard-dns.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Блог</a><a href="https://adguard-dns.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Официальный сайт</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>русский</span></span></a><ul class="dropdown__menu"><li><a href="/KnowledgeBaseDNS/general/dns-filtering-syntax/" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/KnowledgeBaseDNS/ru/general/dns-filtering-syntax/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">русский</a></li><li><a href="/KnowledgeBaseDNS/de/general/dns-filtering-syntax/" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Deutsch</a></li><li><a href="/KnowledgeBaseDNS/fr/general/dns-filtering-syntax/" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">français</a></li><li><a href="/KnowledgeBaseDNS/es/general/dns-filtering-syntax/" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">español</a></li><li><a href="/KnowledgeBaseDNS/it/general/dns-filtering-syntax/" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">italiano</a></li><li><a href="/KnowledgeBaseDNS/ja/general/dns-filtering-syntax/" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">日本語</a></li><li><a href="/KnowledgeBaseDNS/ko/general/dns-filtering-syntax/" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">한국어</a></li><li><a href="/KnowledgeBaseDNS/zh-CN/general/dns-filtering-syntax/" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">中文（中国）</a></li><li><a href="/KnowledgeBaseDNS/zh-TW/general/dns-filtering-syntax/" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">中文（台灣）</a></li></ul></div><a href="https://github.com/AdguardTeam/KnowledgeBaseDNS" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/KnowledgeBaseDNS/ru/"><img src="/KnowledgeBaseDNS/ru/img/logo.svg" alt="AdGuard DNS" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/KnowledgeBaseDNS/ru/img/logo_dark.svg" alt="AdGuard DNS" class="themedImage_1VuW themedImage--dark_hz6m"><b></b></a><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/KnowledgeBaseDNS/ru/">Обзор</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Общее</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/KnowledgeBaseDNS/ru/general/dns-filtering/">DNS-фильтрация</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/KnowledgeBaseDNS/ru/general/dns-filtering-syntax/">Синтаксис правил DNS-фильтрации</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/KnowledgeBaseDNS/ru/general/dns-providers/">Известные DNS-провайдеры</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Публичный DNS</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Приватный DNS</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Разное</a></li></ul></nav><button type="button" title="Свернуть боковую панель" aria-label="Свернуть боковую панель" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">На этой странице</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Синтаксис правил DNS-фильтрации</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="введение"></a>Введение<a class="hash-link" href="#введение" title="Прямая ссылка на заголовок">#</a></h2><p>Синтаксис правил фильтрации AdGuard DNS можно использовать, чтобы сделать правила более гибкими и блокировать контент в соответствии с вашими предпочтениями. Синтаксис правил фильтрации AdGuard DNS можно использовать в разных продуктах AdGuard, таких как AdGuard Home, AdGuard DNS, AdGuard для Windows/Mac/Android.</p><p>Есть три подхода к написанию списков правил фильтрации:</p><ul><li><p><a href="#adblock-style-syntax">Синтаксис в стиле Adblock</a>: современный подход к написанию правил фильтрации, базирующийся на использовании подгруппы синтаксиса правил типа Adblock. Таким образом списки блокировки становятся совместимы с браузерными блокировщиками.</p></li><li><p><a href="#etc-hosts-syntax"><code>/etc/hosts</code> синтаксис</a>: это старый и проверенный подход, при котором используется тот же синтаксис, что и в операционных системах для hosts-файлов.</p></li><li><p><a href="#domains-only-syntax">Синтаксис Domains-only</a>: простое перечисление имён доменов.</p></li></ul><p>Если вы создаете списки блокировки, мы рекомендуем использовать <a href="#adblock-style-syntax">синтаксис Adblock</a>. У него есть несколько важных преимуществ перед старым синтаксисом:</p><ul><li><p><strong>Размер списков блокировки.</strong> Применяя сопоставление шаблонов, вы сможете использовать одно правило вместо сотен записей <code>/etc/hosts</code>.</p></li><li><p><strong>Совместимость.</strong> Ваш список блокировки будет совместим с браузерными блокировщиками рекламы, что сделает обмен правилами с фильтрами браузера более простым.</p></li><li><p><strong>Расширяемость.</strong> За последнее десятилетие синтаксис Adblock значительно развился, и мы не видим причин, почему мы не можем расширить его ещё больше и дать дополнительные возможности сетевым блокировщикам.</p></li></ul><p>Если вы ведёте список блокировки типа <code>/etc/hosts</code> или поддерживаете списки из множества фильтров, невзирая на их тип, мы предлагаем инструмент, с помощью которого можно составлять списки блокировки. Мы назвали его <a href="https://github.com/AdguardTeam/HostlistCompiler" target="_blank" rel="noopener noreferrer">Hostlist compiler</a> и сами используем его для создания <a href="https://github.com/AdguardTeam/AdGuardSDNSFilter" target="_blank" rel="noopener noreferrer">фильтра AdGuard DNS</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="базовые-примеры"></a>Базовые примеры<a class="hash-link" href="#базовые-примеры" title="Прямая ссылка на заголовок">#</a></h2><ul><li><p><code>||example.org^</code>: блокирует доступ к домену <code>example.org</code> и всем его поддоменам, таким как <code>www.example.org</code>.</p></li><li><p><code>@@||example.org^</code>: разблокирует доступ к домену <code>example.org</code> и всем его поддоменам.</p></li><li><p><code>1.2.3.4 example.org</code>: (внимание, устаревший синтаксис типа <code>/etc/hosts</code>) отвечает <code>1.2.3.4</code> на запросы к домену <code>example.org</code>, но <strong>не</strong> к его поддоменам. <code>www.example.org</code> остаётся доступным.</p></li></ul><p>Использование неопределённого IP-адреса (<code>0.0.0.0</code>) или локального адреса (<code>127.0.0.1</code> и т. п.) для хоста практически то же самое, что и блокировка этого хоста.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># Возвращает IP-адрес 1.2.3.4. для example.org.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">1.2.3.4 example.org</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># Блокирует example.com ответом 0.0.0.0.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">0.0.0.0 example.com</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><ul><li><p><code>example.org</code>: простое доменное правило. Блокирует домен <code>example.org</code>, но <strong>не</strong> его поддомены. <code>www.example.org</code> остаётся доступным.</p></li><li><p><code>! Это комментарий </code> и <code> # Это тоже комментарий</code>: комментарии.</p></li><li><p><code>/REGEX/</code>: блокирует доступ к доменам, соответствующим заданному регулярному выражению.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="синтаксис-по-примеру-блокировщиков"></a>Синтаксис по примеру блокировщиков<a class="hash-link" href="#синтаксис-по-примеру-блокировщиков" title="Прямая ссылка на заголовок">#</a></h2><p>Это подсистема <a href="https://kb.adguard.com/ru/general/how-to-create-your-own-ad-filters" target="_blank" rel="noopener noreferrer">традиционного синтаксиса блокировщиков</a>, который используется браузерными блокировщиками.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">     rule = [&quot;@@&quot;] pattern [ &quot;$&quot; modifiers ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> modifiers = [modifier0, modifier1[, ...[, modifierN]]]</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><ul><li><p><code>pattern</code>: маска имени хоста. Каждое имя хоста сопоставляется с этой маской. Шаблон также может содержать особые знаки, о которых сказано ниже.</p></li><li><p><code>@@</code>: маркер, использующийся в правилах исключений. Ставьте этот маркер в начало правила, если хотите отключить фильтрацию для совпадающих имен хостов.</p></li><li><p><code>modifiers</code>: параметры, объясняющие правило. Они могут ограничить сферу применения правила или даже полностью изменить принцип его действия.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="специальные-символы"></a>Специальные символы<a class="hash-link" href="#специальные-символы" title="Прямая ссылка на заголовок">#</a></h3><ul><li><p><code>*</code>: подстановочный знак. Используется, чтобы обозначить любой набор символов. Это может быть пустая строка или строка любой длины.</p></li><li><p><code>||</code>: совпадает с началом имени хоста, включая любые субдомены.  Например, <code>||example.org</code> соответствует <code>example.org</code> и <code>test.example.org</code>, но не <code>testexample.org</code>.</p></li><li><p><code>^</code>: символ-разделитель. В отличие от блокировки рекламы в браузере в имени хоста нечего разделять, поэтому единственная цель этого символа — отметить конец имени хоста.</p></li><li><p><code>|</code>: указатель на начало или конец имени хоста. Значение зависит от расположения символов в маске. Например, правило <code>example.org|</code> относится к <code>example.org</code>, но не к <code>example.org.com</code>. А правило <code>|example</code> относится к <code>example.org</code>, но не к <code>test.example</code>.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="регулярные-выражения"></a>Регулярные выражения<a class="hash-link" href="#регулярные-выражения" title="Прямая ссылка на заголовок">#</a></h3><p>Если вы хотите добиться ещё большей гибкости при составлении правил, вы можете использовать <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions" target="_blank" rel="noopener noreferrer">регулярные выражения</a> вместо упрощённой маски со специальными символами, которая используется по умолчанию. Если вы хотите использовать регулярные выражения, шаблон должен выглядеть так:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">pattern = &quot;/&quot; regexp &quot;/&quot;</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p><strong>Примеры:</strong></p><ul><li><p><code>/example.*/</code> заблокирует хосты, совпадающие с регулярным выражением <code>example.*</code>.</p></li><li><p><code>@@/example.*/$important</code> разблокирует хосты, совпадающие с регулярным выражением <code>example.*</code>. Обратите внимание, что это правило также включает модификатор <code>important</code>.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="комментарии"></a>Комментарии<a class="hash-link" href="#комментарии" title="Прямая ссылка на заголовок">#</a></h3><p>Любая строка, начинающаяся с восклицательного знака или хеша, является комментарием, будет проигнорирована движком фильтрации. Комментарии обычно размещаются над правилами и описывают то, что они делают.</p><p><strong>Пример:</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">! Это комментарий.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># Это тоже комментарий.</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="модификаторы-правил"></a>Модификаторы правил<a class="hash-link" href="#модификаторы-правил" title="Прямая ссылка на заголовок">#</a></h3><p>Вы можете изменить поведение правила при помощи модификаторов. Их необходимо располагать в конце правила после символа <code>$</code> и разделять запятыми.</p><p><strong>Примеры:</strong></p><ul><li><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div></li></ul><p><code>||example.org^</code> — паттерн правила. <code>$</code> — разделитель, который указывает на то, что остальные части правила — это модификаторы. <code>important</code> — модификатор.</p><ul><li><p>Вы можете захотеть использовать несколько модификаторов в одном правиле. Разделяйте их запятыми, если:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">||example.org^$client=127.0.0.1,dnstype=A</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div></li></ul><p><code>||example.org^</code> — совпадающий шаблон. <code>$</code> — разделитель, который указывает на то, что остальные части правила являются модификаторами. <code>client=127.0.0.1</code> — это модификатор <a href="#client"><code>клиента</code></a>, значение которого, <code>127.0.0.1</code>, является разделителем. И наконец, <code>dnstype=A</code> — <a href="#dnstype"><code>dnstype-модификатор</code></a> со значением <code>А</code>.</p><p><strong>Обратите внимание:</strong> если правило содержит модификатор, не указанный в этом документе, всё правило <strong>следует игнорировать</strong>. Таким образом мы избегаем ложных срабатываний, когда люди пытаются использовать немодифицированные списки фильтров браузерных блокировщиков рекламы, таких как EasyList или EasyPrivacy.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="клиент"></a><code>клиент</code><a class="hash-link" href="#клиент" title="Прямая ссылка на заголовок">#</a></h4><p>Модификатор <code>client</code> позволяет указывать клиентов, к которым применяется это правило. Есть два основных способа определения клиента:</p><ul><li><p>По его IP-адресу или CIDR-префиксу. Этот способ подходит для всех типов клиентов.</p></li><li><p>По имени. Этот способ работает только для сохранённых клиентов в AdGuard Home и устройств в приватном AdGuard DNS, которых вы добавили вручную.</p></li></ul><p><strong>Внимание:</strong> в AdGuard Home ClientID временно не поддерживаются, только имена. Если вы добавили клиента с именем «My Client» и ID клиента<code>my-client</code>, напишите модификатор как <code>$client=&#x27;My Client&#x27;</code>, а не <code>$client=my-client</code>.</p><p>Синтаксис:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$client=value1|value2|...</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>Вы также можете исключить клиента из фильтрации, добавив перед значением символ <code>~</code>. В этом случае правило не будет применяться к DNS-запросам этого клиента.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$client=~value1</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>Имена клиентов обычно содержат пробелы или другие специальные символы, поэтому необходимо заключать их в кавычки. Поддерживаются как одинарные, так и двойные кавычки ASCII.  Используйте обратный слеш (<code>\</code>), чтобы изолировать кавычки (<code>&quot;</code> и <code>&#x27;</code>), запятые (<code>,</code>) и вертикальные разделители (<code>|</code>).</p><p><strong>Обратите внимание:</strong> исключая клиентов из фильтрации, <strong>обязательно</strong> выносите символ <code>~</code> за кавычки.</p><p><strong>Примеры:</strong></p><ul><li><p><code>@@||*^$client=127.0.0.1</code>: разблокирует всё для localhost.</p></li><li><p><code>||example.org^$client=&#x27;Frank\&#x27;s laptop&#x27;</code>: блокирует домен <code>example.org</code> только для клиента с именем <code>Frank&#x27;s laptop</code>.  Обратите внимание, что апостроф (<code>&#x27;</code>) в имени должен быть экранирован.</p></li><li><p><code>||example.org^$client=~&#x27;Mary\&#x27;s\, John\&#x27;s\, and Boris\&#x27;s laptops&#x27;</code>: блокирует домен <code>example.org</code> для всех, кроме клиентов с именами <code>Mary&#x27;s, John&#x27;s, and Boris&#x27;s laptops</code>.  Как вы видите, запятая (<code>,</code>) тоже должна быть экранирована.</p></li><li><p><code>||example.org^$client=~Mom|~Dad|Kids</code>: блокирует домен <code>example.org</code> для клиента <code>Kids</code>, но не для клиентов <code>Mom</code> и <code>Dad</code>. Этот пример демонстрирует, как указать несколько клиентов в одном правиле.</p></li><li><p><code>||example.org^$client=192.168.0.0/24</code>: блокирует домен <code>example.org</code> для клиентов с IP-адресами в диапазоне от <code>192.168.0.0</code> до <code>192.168.0.255</code>.</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="denyallow"></a><code>denyallow</code><a class="hash-link" href="#denyallow" title="Прямая ссылка на заголовок">#</a></h4><p>Вы можете использовать модификатор <code>denyallow</code>, чтобы исключить домены из правила блокировки. Чтобы добавить несколько доменов в одно правило, используйте символ <code>|</code> в качестве разделителя.</p><p>Синтаксис:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$denyallow=domain1|domain2|...</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>Этот модификатор позволяет избежать создания ненужных правил исключения, когда блокирующее правило охватывает слишком много доменов. Возможно, вы захотите заблокировать всё, за исключением нескольких доменов верхнего уровня. Вы можете использовать стандартный подход, т.е. такие правила, как эти:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">! Заблокировать всё.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">/.*/</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">! Разблокировать несколько доменов верхнего уровня.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@@||com^</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@@||net^</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>Проблема этого подхода в том, что вы также разблокируете отслеживающие домены, расположенные на этих доменах верхнего уровня (например, <code>google-analytics.com</code>). Но её можно решить с помощью модификатора <code>denyallow</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">*$denyallow=com|net</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p><strong>Примеры:</strong></p><ul><li><p><code>*$denyallow=com|net</code>: блокирует все домены <code>*.com</code> и <code>*.net</code>.</p></li><li><p><code>@@*$denyallow=com|net</code>: разблокирует все домены <code>*.com</code> и <code>*.net</code>.</p></li><li><p><code>||example.org^$denyallow=sub.example.org</code>. блокирует <code>example.org</code> и <code>*.example.org</code>, но не блокирует <code>sub.example.org</code>.</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="dnstype"></a><code>dnstype</code><a class="hash-link" href="#dnstype" title="Прямая ссылка на заголовок">#</a></h4><p>Модификатор <code>dnstype</code> позволяет указать тип DNS-запроса или ответа, на который будет срабатывать это правило.</p><p>Синтаксис:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$dnstype=value1|value2|...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$dnstype=~value1|~value2|~...</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>Имена типов можно указывать в любом регистре, но они проверяются на соответствие настоящим типам DNS-записей.</p><p>Не объединяйте исключающие правила с включающими. Например, это правило:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$dnstype=~value1|value2</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>эквивалентно этому:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$dnstype=value2</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p><strong>Примеры:</strong></p><ul><li><p><code>||example.org^$dnstype=AAAA</code>: блокирует DNS-запросы для IPv6-адресов домена <code>example.org</code>.</p></li><li><p><code>||example.org^$dnstype=~A|~CNAME</code>: пропускает только <code>A</code> и <code>CNAME</code> DNS-запросы для домена <code>example.org</code> и блокирует все остальные.</p></li></ul><p><strong>Обратите внимание:</strong> до версии <strong>0.108.0</strong> для фильтрации записей ответа AdGuard Home использовал тип запроса, а не тип ответа самой записи.  Это вызывало проблемы, поскольку у пользователя не было возможности написать правила, которые разрешали бы определённые записи <code>CNAME</code> в ответах на запросы <code>A</code> и <code>AAAA</code>. Начиная с версии <strong>0.108.0</strong> были внесены изменения, и теперь это правило:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">||canon.example.com^$dnstype=~CNAME</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>позволяет избежать фильтрации следующего ответа:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ОТВЕТЫ:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">-&gt;  example.com</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    canonical name = canon.example.com.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ttl = 60</span></span><span class="token-line" style="color:#393A34"><span class="token plain">-&gt;  canon.example.com</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    internet address = 1.2.3.4</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ttl = 60</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="dnsrewrite"></a><code>dnsrewrite</code><a class="hash-link" href="#dnsrewrite" title="Прямая ссылка на заголовок">#</a></h4><p>Модификатор ответа <code>dnsrewrite</code> позволяет заменить содержание ответа на DNS-запрос для совпадающих хостов. Обратите внимание, что этот модификатор работает во всех правилах AdGuard Home, а в приватном AdGuard DNS — только в пользовательских.</p><p><strong>Правила, содержащие модификатор ответа <code>dnsrewrite</code>, получают больший приоритет в сравнении с другими правилами в AdGuard Home.</strong></p><p>Сокращённый синтаксис:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$dnsrewrite=1.2.3.4</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$dnsrewrite=abcd::1234</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$dnsrewrite=example.net</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$dnsrewrite=REFUSED</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>Ключевые слова должны быть написаны заглавными буквами (например, <code>NOERROR</code>). Перезапись ключевых слов получает приоритет над предыдущими, результатом будет пустой ответ с соответствующим кодом.</p><p>Полный синтаксис использует форму <code>RCODE;RRTYPE;VALUE</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$dnsrewrite=NOERROR;A;1.2.3.4</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$dnsrewrite=NOERROR;AAAA;abcd::1234</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$dnsrewrite=NOERROR;CNAME;example.net</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$dnsrewrite=REFUSED;;</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>У модификатора <code>$dnsrewrite</code> с кодом ответа <code>NOERROR</code> также могут быть пустые поля <code>RRTYPE</code> и <code>VALUE</code>.</p><p>Модификатор <code>CNAME</code> особенный, поскольку AdGuard Home будет резолвить хост и добавит его информацию к ответу. Так будет происходить, если у домена <code>example.net</code> будет IP-адрес <code>1.2.3.4</code>, а у пользователя в правилах фильтрации указано следующее:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">||example.com^$dnsrewrite=example.net</span></span><span class="token-line" style="color:#393A34"><span class="token plain">! Или:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">||example.com^$dnsrewrite=NOERROR;CNAME;example.net</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>В таком случае ответ будет выглядеть примерно так:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ nslookup example.com my.adguard.local</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Сервер:     my.adguard.local</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Адрес:    127.0.0.1#53</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Не заслуживающий доверия ответ:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">example.com canonical name = example.net.n</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Имя:   example.net</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Адрес: 1.2.3.4</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>Далее идёт перезапись <code>CNAME</code>.  После этого все значения других записей суммируются в один ответ, таким образом это:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">||example.com^$dnsrewrite=NOERROR;A;1.2.3.4</span></span><span class="token-line" style="color:#393A34"><span class="token plain">||example.com^$dnsrewrite=NOERROR;A;1.2.3.5</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>получит ответ с двумя записями <code>A</code>.</p><p>В данный момент поддерживаются подобные ресурсные записи:</p><ul><li><code>||4.3.2.1.in-addr.arpa^$dnsrewrite=NOERROR;PTR;example.net.</code> добавляет запись <code>PTR</code> для обратного DNS. Обратные DNS-запросы на <code>1.2.3.4</code> к DNS-серверу получат результат <code>example.net</code>.</li></ul><p><strong>Обратите внимание:</strong> IP-адрес должен быть указан в обратном порядке. Больше информации здесь: <a href="https://tools.ietf.org/html/rfc1035#section-3.5" target="_blank" rel="noopener noreferrer">RFC 1035</a>.</p><ul><li><p><code>||example.com^$dnsrewrite=NOERROR;A;1.2.3.4</code> добавляет запись <code>A</code> со значением <code>1.2.3.4</code>.</p></li><li><p><code>||example.com^$dnsrewrite=NOERROR;AAAA;abcd::1234</code> добавляет запись <code>AAAA</code> со значением <code>abcd::1234</code>.</p></li><li><p><code>||example.com^$dnsrewrite=NOERROR;CNAME;example.org</code> добавляет запись <code>CNAME</code>. Выше объяснение, почему так.</p></li><li><p><code>||example.com^$dnsrewrite=NOERROR;HTTPS;32 example.com alpn=h3</code> добавляет запись <code>HTTPS</code>. Поддерживается только подмножество значений параметров: значения должны быть <code>смежными </code> и, там, где ожидался <code>список значений</code>, только одно значение поддерживается:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ipv4hint=127.0.0.1             // Поддерживается.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ipv4hint=&quot;127.0.0.1&quot;           // Не поддерживается.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ipv4hint=127.0.0.1,127.0.0.2   // Не поддерживается.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ipv4hint=&quot;127.0.0.1,127.0.0.2&quot; // Не поддерживается.</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div></li></ul><p>В будущем это изменится.</p><ul><li><p><code>||example.com^$dnsrewrite=NOERROR;MX;32 example.mail</code> добавляет запись <code>MX</code> с порядковым номером <code>32</code> и доменным именем почтового сервера <code>example.mail</code>.</p></li><li><p><code>||example.com^$dnsrewrite=NOERROR;SVCB;32 example.com alpn=h3</code> добавляет значение <code>SVCB</code>.  Посмотрите на пример <code>HTTPS</code> выше.</p></li><li><p><code>||example.com^$dnsrewrite=NOERROR;TXT;hello_world</code> добавляет запись <code>TXT</code> со значением <code>hello_world</code>.</p></li><li><p><code>||_svctype._tcp.example.com^$dnsrewrite=NOERROR;SRV;10 60 8080 example.com</code> добавляет запись <code>SRV</code> с приоритетным значением <code>10</code>, значением веса <code>60</code>, портом <code>8080</code> и целевым значением <code>example.com</code>.</p></li><li><p><code>||example.com^$dnsrewrite=NXDOMAIN;;</code> отвечает кодом <code>NXDOMAIN</code>.</p></li><li><p><code>$dnstype=AAAA,denyallow=example.org,dnsrewrite=NOERROR;;</code> отвечает пустым <code>NOERROR</code> значением для всех запросов <code>AAAA</code>, кроме запросов к <code>example.org</code>.</p></li></ul><p>Правила исключений отменяют одно или все правила:</p><ul><li><p><code>@@||example.com^$dnsrewrite</code> отменяет все правила DNS rewrite.</p></li><li><p><code>@@||example.com^$dnsrewrite=1.2.3.4</code> убирает правило DNS rewrite, которое добавляет запись <code>A</code> со значением <code>1.2.3.4</code>.</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="важно"></a><code>важно</code><a class="hash-link" href="#важно" title="Прямая ссылка на заголовок">#</a></h4><p>Модификатор <code>important</code>, применённый к правилу, повышает его приоритет по отношению к любому другому правилу без модификатора. Это относится даже к базовым правилам исключений.</p><p><strong>Примеры:</strong></p><ul><li>В этом примере:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">||example.org^$important</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@@||example.org^</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p><code>||example.org^$important</code> заблокирует все запросы к <code>*.example.org</code>, кроме правила исключения.</p><ul><li>В этом примере:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">||example.org^$important</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@@||example.org^$important</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>правило исключения также содержит модификатор <code>important</code>, поэтому правило сработает.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="badfilter"></a><code>badfilter</code><a class="hash-link" href="#badfilter" title="Прямая ссылка на заголовок">#</a></h4><p>Правила с модификатором <code>badfilter</code> отключают другие базовые правила, на которые они ссылаются. Это означает, что текст отключенного правила должен совпадать с текстом правила <code>badfilter</code> (без модификатора <code>badfilter</code>).</p><p><strong>Примеры:</strong></p><ul><li><p><code>||example.com$badfilter</code> отменяет <code>||example.com</code>.</p></li><li><p><code>@@||example.org^$badfilter</code> отменяет <code>@@||example.org^</code>.</p></li></ul><p><strong>Обратите внимание:</strong> модификатор <code>badfilter</code> не работает с правилами <code>/etc/hosts</code>.  <code>127.0.0.1 example.org$badfilter</code> <strong>не отменяет</strong> оригинальное правило <code>127.0.0.1 example.org</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="ctag"></a><code>ctag</code><a class="hash-link" href="#ctag" title="Прямая ссылка на заголовок">#</a></h4><p><strong>Модификатор <code>ctag</code> может использоваться только в AdGuard Home.</strong> Он блокирует домены только определённых типов тегов DNS-клиентов. Вы можете присвоить теги клиентам в пользовательском интерфейсе AdGuard Home. В будущем, мы планируем присваивать теги после анализа поведения каждого клиента.</p><p>Синтаксис:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ctag=value1|value2|...</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>Если один из клиентских тегов совпадает со значениями <code>ctag</code>, то это правило применяется к клиенту. Синтаксис для исключения:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ctag=~value1|~value2|...</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>Если один из клиентских тегов совпадает со значениями исключения <code>ctag</code>, то это правило не применяется к клиенту.</p><p><strong>Примеры:</strong></p><ul><li><p><code>||example.org^$ctag=device_pc|device_phone</code>: блокировать <code>example.org</code> для тегов <code>device_pc</code> или <code>device_phone</code>.</p></li><li><p><code>||example.org^$ctag=~device_phone</code>: блокировать <code>example.org</code> для всех тегов, кроме <code>device_phone</code>.</p></li></ul><p>Список разрешённых тегов:</p><ul><li><p>По типу устройства:</p><ul><li><code>device_audio</code>: аудиоустройства.</li><li><code>device_camera</code>: фотоаппараты.</li><li><code>device_gameconsole</code>: игровые консоли.</li><li><code>device_laptop</code>: ноутбуки,</li><li><code>device_nas</code>: системы NAS (сетевые хранилища).</li><li><code>device_pc</code>: ПК.</li><li><code>device_phone</code>: телефоны.</li><li><code>device_printer</code>: принтеры.</li><li><code>device_securityalarm</code>: системы сигнализации.</li><li><code>device_tablet</code>: планшеты.</li><li><code>device_tv</code>: телевизоры.</li><li><code>device_other</code>: другие устройства.</li></ul></li><li><p>По операционной системе:</p><ul><li><code>os_android</code>: Android.</li><li><code>os_ios</code>: iOS.</li><li><code>os_linux</code>: Linux.</li><li><code>os_macos</code>: macOS.</li><li><code>os_windows</code>: Windows.</li><li><code>os_other</code>: другие операционные системы.</li></ul></li><li><p>По группам пользователей:</p><ul><li><code>user_admin</code>: администраторы.</li><li><code>user_regular</code>: рядовые пользователи.</li><li><code>user_child</code>: дети.</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="etc-hosts-syntax"></a>Синтаксис <code>/etc/hosts</code><a class="hash-link" href="#etc-hosts-syntax" title="Прямая ссылка на заголовок">#</a></h2><p>Для каждого хоста должна быть строка со следующей информацией:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">IP_address canonical_hostname [aliases...]</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>Поля для ввода данных разделены любым количеством пробелов или символов табуляции. Текст от знака <code>#</code> до конца строки — это комментарий, он игнорируется.</p><p>Имена хостов могут содержать только буквенно-численные значения, дефис-минусы (<code>-</code>) и точки (<code>.</code>). Они должны начинаться буквенным значением и заканчиваться буквенно-численным. Дополнительные псевдонимы предлагаются со сменой названий, альтернативным написанием, укороченными или универсальными именами хостов (например, <code>localhost</code>).</p><p><strong>Пример:</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># Это комментарий</span></span><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1 example.org example.info</span></span><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1 example.com</span></span><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1 example.net # это тоже комментарий</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>В AdGuard Home IP-адреса используются для ответа на DNS-запросы по этим доменам. В приватном DNS эти адреса просто блокируются.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="синтаксис-domains-only"></a>Синтаксис Domains-only<a class="hash-link" href="#синтаксис-domains-only" title="Прямая ссылка на заголовок">#</a></h2><p>Простое перечисление имён доменов, по одному в линию.</p><p>Пример:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly none"><pre tabindex="0" class="prism-code language-none codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># Это комментарий</span></span><span class="token-line" style="color:#393A34"><span class="token plain">example.com</span></span><span class="token-line" style="color:#393A34"><span class="token plain">example.org</span></span><span class="token-line" style="color:#393A34"><span class="token plain">example.net # это тоже комментарий</span></span></code></pre><button type="button" aria-label="Скопировать код" class="copyButton_Ue-o clean-btn">Копировать</button></div></div><p>Если в строке указан недействительный домен (например, <code>*.example.org</code>), AdGuard Home посчитает его правилом <a href="#adblock-style-syntax">в стиле блокировщика</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="компилятор-хостлистов"></a>Компилятор хостлистов<a class="hash-link" href="#компилятор-хостлистов" title="Прямая ссылка на заголовок">#</a></h2><p>Если вы содержите список блокировки и используете в нём разные источники, <a href="https://github.com/AdguardTeam/HostlistCompiler" target="_blank" rel="noopener noreferrer">Транслятор хостлистов</a> может быть вам полезным. Этот инструмент упрощает составление списка блокировки hosts, совместимого с AdGuard Home, приватным AdGuard DNS или любым другим продуктом AdGuard с DNS-фильтрацией.</p><p>Что он может сделать:</p><ol><li><p>Собрать единый список блокировки из разных источников.</p></li><li><p>Исключить правила, которые вам не нужны.</p></li><li><p>Подчистить список, получившийся в результате: убрать дубли, неработающие правила и сжать список.</p></li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/AdguardTeam/KnowledgeBaseDNS/edit/master/docs/general/dns-filtering-syntax.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Редактировать страницу</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Навигация по страницам документов"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/KnowledgeBaseDNS/ru/general/dns-filtering/"><div class="pagination-nav__sublabel">Назад</div><div class="pagination-nav__label">« DNS-фильтрация</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/KnowledgeBaseDNS/ru/general/dns-providers/"><div class="pagination-nav__sublabel">Вперёд</div><div class="pagination-nav__label">Известные DNS-провайдеры »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#введение" class="table-of-contents__link">Введение</a></li><li><a href="#базовые-примеры" class="table-of-contents__link">Базовые примеры</a></li><li><a href="#синтаксис-по-примеру-блокировщиков" class="table-of-contents__link">Синтаксис по примеру блокировщиков</a><ul><li><a href="#специальные-символы" class="table-of-contents__link">Специальные символы</a></li><li><a href="#регулярные-выражения" class="table-of-contents__link">Регулярные выражения</a></li><li><a href="#комментарии" class="table-of-contents__link">Комментарии</a></li><li><a href="#модификаторы-правил" class="table-of-contents__link">Модификаторы правил</a></li></ul></li><li><a href="#etc-hosts-syntax" class="table-of-contents__link">Синтаксис <code>/etc/hosts</code></a></li><li><a href="#синтаксис-domains-only" class="table-of-contents__link">Синтаксис Domains-only</a></li><li><a href="#компилятор-хостлистов" class="table-of-contents__link">Компилятор хостлистов</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">AdGuard DNS</div><ul class="footer__items"><li class="footer__item">Cloud-based DNS service that will help you protect privacy and block ads.</li></ul></div><div class="col footer__col"><div class="footer__title">AdGuard DNS</div><ul class="footer__items"><li class="footer__item"><a href="https://adguard-dns.io/public-dns.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Подключиться к DNS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://adguard-dns.io/support.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Техподдержка<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://adguard-dns.io/support/faq.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>FAQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Компания</div><ul class="footer__items"><li class="footer__item"><a href="https://adguard.com/blog/tag/adguard-dns.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Блог<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://adguard.com/privacy/dns.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Политика конфиденциальности<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://adguard.com/eula.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Условия использования<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://status.adguard.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Статус сервисов AdGuard<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Другие продукты</div><ul class="footer__items"><li class="footer__item"><a href="https://adguard.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Блокировщик AdGuard<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://adguard-vpn.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>AdGuard VPN<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/KnowledgeBaseDNS/ru/img/logo_dark.svg" alt="AdGuard DNS" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/KnowledgeBaseDNS/ru/img/logo_dark.svg" alt="AdGuard DNS" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></div><div class="footer__copyright">© AdGuard DNS, 2022</div></div></div></footer></div>
<script src="/KnowledgeBaseDNS/ru/assets/js/runtime~main.97a4d7a8.js"></script>
<script src="/KnowledgeBaseDNS/ru/assets/js/main.9a2496f3.js"></script>
</body>
</html>